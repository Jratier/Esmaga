<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contagem de Estoque</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
        }
        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
        #materialInfo {
            margin-top: 20px;
        }
        .button {
            padding: 10px 15px;
            margin: 5px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        .button:disabled {
            background-color: #ccc;
        }
        .button-error {
            background-color: #dc3545;
        }
        .button-success {
            background-color: #28a745;
        }
        #linhaMaterial {
            padding: 10px;
            margin-top: 20px;
            background-color: #f9f9f9;
        }
        #errorsTable {
            display: none;
        }
    </style>
</head>
<body>

    <h1>Contagem de Estoque</h1>

    <!-- Botão para importar o arquivo -->
    <input type="file" id="fileInput" accept=".csv" class="button">
    <button id="btnLoad" class="button">Carregar Arquivo</button>

    <div id="materialInfo">
        <h3>Informações do Material</h3>
        <div id="linhaMaterial">
            <p><strong>Código:</strong> <span id="codigoMaterial"></span></p>
            <p><strong>Descrição:</strong> <span id="descricaoMaterial"></span></p>
            <p><strong>Quantidade:</strong> <span id="quantidadeMaterial"></span></p>
            <p><strong>Unidade de Medida:</strong> <span id="unidadeMedida"></span></p>
        </div>

        <button class="button-success" onclick="marcarComoContado()">Material Contado</button>
        <button class="button-error" onclick="corrigirMaterial()">Material Errado</button>
        <button class="button" onclick="proximoMaterial()">Próximo</button>
        <button class="button" onclick="mostrarErros()">Ver Lista de Erros</button>
    </div>

    <!-- Tabela de erros -->
    <div id="errorsTable">
        <h3>Materiais com Erros</h3>
        <table>
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Descrição</th>
                    <th>Quantidade Corrigida</th>
                    <th>Unidade de Medida</th>
                </tr>
            </thead>
            <tbody id="errorsBody"></tbody>
        </table>
    </div>

    <script>
        let materiais = [];
        let indexAtual = 0;
        let errors = [];
        let contados = [];

        document.getElementById('btnLoad').addEventListener('click', function() {
            let fileInput = document.getElementById('fileInput');
            let file = fileInput.files[0];

            if (file) {
                let reader = new FileReader();
                reader.onload = function(e) {
                    let contents = e.target.result;
                    processarCSV(contents);
                    mostrarMaterial(indexAtual);
                    fileInput.style.display = 'none'; // Ocultar botão de upload após carregar
                    document.getElementById('btnLoad').style.display = 'none';
                };
                reader.readAsText(file);
            } else {
                alert("Por favor, selecione um arquivo.");
            }
        });

        function processarCSV(texto) {
            let linhas = texto.split('\n');
            for (let i = 1; i < linhas.length; i++) {
                let colunas = linhas[i].split(';');
                if (colunas.length >= 4) {
                    materiais.push({
                        codigo: colunas[0].trim(),
                        descricao: colunas[1].trim(),
                        quantidade: colunas[2].trim(),
                        unidade: colunas[3].trim()
                    });
                }
            }
        }

        function mostrarMaterial(index) {
            if (index >= 0 && index < materiais.length) {
                let material = materiais[index];
                document.getElementById('codigoMaterial').innerText = material.codigo;
                document.getElementById('descricaoMaterial').innerText = material.descricao;
                document.getElementById('quantidadeMaterial').innerText = material.quantidade;
                document.getElementById('unidadeMedida').innerText = material.unidade;
            }
        }

        function marcarComoContado() {
            let codigo = document.getElementById("codigoMaterial").innerText;
            let descricao = document.getElementById("descricaoMaterial").innerText;
            let quantidade = document.getElementById("quantidadeMaterial").innerText;
            let unidade = document.getElementById("unidadeMedida").innerText;

            contados.push({
                codigo: codigo,
                descricao: descricao,
                quantidade: quantidade,
                unidade: unidade
            });

            alert("Material marcado como contado.");
            proximoMaterial();  // Avança para o próximo material
        }

        function corrigirMaterial() {
            var novaQuantidade = prompt("Digite a quantidade correta:");

            if (novaQuantidade != null) {
                let codigo = document.getElementById("codigoMaterial").innerText;
                let descricao = document.getElementById("descricaoMaterial").innerText;
                let unidade = document.getElementById("unidadeMedida").innerText;

                errors.push({
                    codigo: codigo,
                    descricao: descricao,
                    novaQuantidade: novaQuantidade,
                    unidade: unidade
                });

                alert("Material adicionado aos erros com a quantidade corrigida.");
                proximoMaterial();  // Avança para o próximo material
            }
        }

        function proximoMaterial() {
            indexAtual++;
            if (indexAtual < materiais.length) {
                mostrarMaterial(indexAtual);
            } else {
                alert("Você terminou de contar todos os materiais.");
            }
        }

        function mostrarErros() {
            let errorsTable = document.getElementById("errorsTable");
            let errorsBody = document.getElementById("errorsBody");
            errorsBody.innerHTML = "";  // Limpa a tabela antes de popular

            errors.forEach(function(item) {
                let row = `<tr>
                    <td>${item.codigo}</td>
                    <td>${item.descricao}</td>
                    <td>${item.novaQuantidade}</td>
                    <td>${item.unidade}</td>
                </tr>`;
                errorsBody.innerHTML += row;
            });

            errorsTable.style.display = "block";  // Exibe a tabela de erros
        }
    </script>

</body>
</html>
